<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Punkte-Spiel mit globaler Bestenliste</title>

<style>
  html,body{height:100%;margin:0;overflow:hidden}
  body{
    font-family:sans-serif;display:flex;flex-direction:column;
    justify-content:center;align-items:center;background:#111;color:#fff
  }
  /* ---------- YouTube-Hintergrund ---------- */
  #yt-background{
    position:fixed;inset:0;width:100vw;height:100vh;z-index:-1;
    pointer-events:none;overflow:hidden
  }
  #yt-background iframe{width:100vw;height:100vh}

  /* ---------- UI-Boxen ---------- */
  #startScreen{display:flex;flex-direction:column;align-items:center}
  #gameArea{display:none;flex-direction:column;align-items:center}
  #points{font-size:2em;margin:20px 0}
  #congrats{font-size:2em;color:yellow;margin-bottom:10px;display:none}
  #goBackButton{display:none}

  /* ---------- Bestenliste oben rechts ---------- */
  #highscoreBox{
    position:absolute;top:10px;right:10px;z-index:99;
    background:rgba(0,0,0,.6);padding:10px 14px;border-radius:8px;
    font-size:.9em;line-height:1.4em
  }

  input,button{font-size:1.1em;padding:10px 20px;margin:8px}
</style>
</head>
<body>

<!-- YouTube-Video-Layer -->
<div id="yt-background"></div>

<!-- Highscore-Box -->
<div id="highscoreBox">Lade Bestenliste‚Ä¶</div>

<!-- Start-Screen -->
<div id="startScreen">
  <h1>Willkommen zum Spiel!</h1>
  <input id="playerName" placeholder="Gib deinen Namen ein" />
  <button id="startBtn" onclick="startGame()" disabled>Start</button>
</div>

<!-- Spiel-Bereich -->
<div id="gameArea">
  <button id="goBackButton" onclick="goBackToSubway()">Go back to Subway</button>
  <div id="congrats">Gratulation you made it</div>

  <div id="points">Punkte: 0</div>
  <button onclick="addPoint()">Punkt sammeln</button>

  <h2>Shop</h2>
  <button id="autoclickerButton" onclick="buyAutoclicker()">Autoclicker kaufen (100 Punkte)</button>
  <button id="bgButton" onclick="buyBackground()">Subway Surfer YT-Hintergrund kaufen (1000 Punkte)</button>
  <button id="finalButton" onclick="buyFinalVideo()">Finales Video aktivieren (2 000 000 Punkte)</button>
</div>

<script>
/* ---------- jsonbin.io-Daten ------------ */
const BIN_ID  = "686c0bce8a456b7966bcf833";
const API_KEY = "HIER_DEIN_API_KEY_EINF√úGEN";      //  <<<<<<  einsetzen!
const jsonHeaders = {
  "Content-Type":"application/json",
  "X-Master-Key": API_KEY
};

/* ---------- Spiel-Variablen ------------- */
let playerName = "";
let points = 0;
let autoclickerSpeed = 1000;
let autoclickerInterval = null;
let autoclickerPrice = 100;
let bgBought = false;
let finalBought = false;
let autoclickerPower = 1;

/* ---------- Namenseingabe aktiviert Start ---------- */
playerNameInput = document.getElementById("playerName");
playerNameInput.addEventListener("input",()=>(
  document.getElementById("startBtn").disabled = !playerNameInput.value.trim()
));

/* ---------- Highscore-Funktionen ---------- */
async function loadHighscores(){
  try{
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{headers:jsonHeaders});
    const data = await r.json();
    const scores = (data.record && data.record.scores) || [];
    const box = document.getElementById("highscoreBox");
    box.innerHTML = "<strong>üèÜ Bestenliste</strong><br>";
    scores.forEach((e,i)=> box.innerHTML += `${i+1}. ${e.name}: ${e.score}<br>`);
  }catch(err){
    console.error(err);
    document.getElementById("highscoreBox").textContent="Highscore-Laden fehlgeschlagen";
  }
}

async function saveScore(name,score){
  try{
    // Aktuelle Liste holen
    const resp = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{headers:jsonHeaders});
    const data = await resp.json();
    const list = (data.record && data.record.scores) || [];
    list.push({name,score});
    list.sort((a,b)=> b.score - a.score);
    const top10 = list.slice(0,10);
    // Zur√ºckschreiben
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
      method:"PUT",headers:jsonHeaders,body:JSON.stringify({scores:top10})
    });
  }catch(e){console.error("Score-Speichern fehlgeschlagen",e);}
}

/* ---------- Spiel-Funktionen ------------ */
function startGame(){
  playerName = playerNameInput.value.trim();
  if(!playerName) return;
  document.getElementById("startScreen").style.display="none";
  document.getElementById("gameArea").style.display="flex";
  loadHighscores();                    // Highscores laden
  alert(`Viel Spa√ü, ${playerName}!`);
}

function updatePointsDisplay(){
  document.getElementById("points").textContent = `Punkte: ${points}`;
}

function updateAutoclickerButton(){
  document.getElementById("autoclickerButton").textContent =
    `Autoclicker kaufen (${autoclickerPrice} Punkte)`;
}

function addPoint(){ points++; updatePointsDisplay(); }

function buyAutoclicker(){
  if(points < autoclickerPrice) return alert("Nicht genug Punkte!");
  points -= autoclickerPrice;
  autoclickerPrice += 50;
  autoclickerSpeed /= 2;
  updatePointsDisplay(); updateAutoclickerButton();
  startOrUpdateAutoclicker();
  alert(`Autoclicker gekauft! Tempo: ${autoclickerSpeed} ms`);
}

function startOrUpdateAutoclicker(){
  clearInterval(autoclickerInterval);
  autoclickerInterval = setInterval(()=>{points += autoclickerPower; updatePointsDisplay();}, autoclickerSpeed);
}

function buyBackground(){
  if(bgBought) return alert("Subway-Hintergrund schon aktiv!");
  if(points < 1000) return alert("Nicht genug Punkte!");
  points -= 1000; bgBought=true; updatePointsDisplay();
  showSubwayVideo();
  autoclickerPower = 2000; if(autoclickerInterval) startOrUpdateAutoclicker();
  alert("Subway Surfer Hintergrund aktiviert!");
}

function showSubwayVideo(){
  const id="vTfD20dbxho";
  document.getElementById("yt-background").innerHTML=
    `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}" frameborder="0" allow="autoplay" allowfullscreen></iframe>`;
}

function buyFinalVideo(){
  if(finalBought) return alert("Finales Video schon aktiv!");
  if(points < 2000000) return alert("Nicht genug Punkte!");
  points -= 2000000; finalBought=true; updatePointsDisplay();

  const id="AgpWX18dby4";
  document.getElementById("yt-background").innerHTML=
    `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}" frameborder="0" allow="autoplay" allowfullscreen></iframe>`;

  document.getElementById("congrats").style.display="block";
  document.getElementById("goBackButton").style.display="inline-block";
  alert("Gratulation you made it!");

  /* ------------- Score speichern & Liste neu laden -------------- */
  saveScore(playerName, points).then(loadHighscores);
}

function goBackToSubway(){
  showSubwayVideo();
  document.getElementById("goBackButton").style.display="none";
  document.getElementById("congrats").style.display="none";
}

/* ---------- Buttons initial ---------- */
updateAutoclickerButton();
</script>
</body>
</html>
